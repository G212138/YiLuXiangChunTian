{"version":3,"sources":["assets\\frame\\scripts\\UI\\Panel\\LoadingUI.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,uEAAsE;AACtE,yEAAoE;AACpE,+EAA0E;AAC1E,8CAA6C;AAC7C,2DAA0D;AAC1D,qDAAoD;AACpD,6CAAwC;AACxC,8CAAyC;AAGnC,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAA+B,6BAAW;IAA1C;QAAA,qEA2GC;QAxGW,cAAQ,GAAY,IAAI,CAAC;QACzB,sBAAgB,GAAY,IAAI,CAAC;QACjC,sBAAgB,GAAY,IAAI,CAAC;QAEjC,eAAS,GAAY,IAAI,CAAC;QAC1B,uBAAiB,GAAY,IAAI,CAAC;QAClC,uBAAiB,GAAY,IAAI,CAAC;QAElC,gBAAU,GAAY,IAAI,CAAC;QAC3B,wBAAkB,GAAY,IAAI,CAAC;QACnC,wBAAkB,GAAY,IAAI,CAAC;QACnC,4BAAsB,GAAY,IAAI,CAAC;QAEvC,iBAAW,GAAG,KAAK,CAAC;QACX,kBAAY,GAAW,EAAE,CAAC;QAC1B,oBAAc,GAAW,EAAE,CAAC;;IAyFjD,CAAC;IAvFG,0BAAM,GAAN;QACI,iBAAO,CAAC,UAAU,EAAE,CAAC;QAErB,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAC1B,IAAI,CAAC,IAAI,EAAE,CAAC;IAChB,CAAC;IAEK,wBAAI,GAAV;;;;4BACI,qBAAM,IAAI,CAAC,cAAc,EAAE,EAAA;;wBAA3B,SAA2B,CAAC;wBAC5B,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;wBAC7C,IAAI,CAAC,SAAS,EAAE,CAAC;;;;;KACpB;IAED,WAAW;IACX,sCAAkB,GAAlB;QACI,IAAM,OAAO,GAAW,uBAAU,CAAC,OAAO,IAAI,CAAC,CAAC;QAChD,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,KAAK,OAAO,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,KAAK,OAAO,CAAC;QACtC,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,KAAK,OAAO,CAAC;QACvC,IAAI,CAAC,sBAAsB,CAAC,YAAY,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC,YAAY,CAAC,CAAC,EAAE,SAAS,EAAE,IAAI,CAAC,CAAC;IAC3F,CAAC;IAED,QAAQ;IACF,6BAAS,GAAf;;;;gBACI,2BAAY,CAAC,oBAAoB,CAAC;oBAC9B,KAAI,CAAC,oBAAoB,CAAC,KAAI,CAAC,YAAY,GAAG,KAAI,CAAC,cAAc,CAAC,CAAC;oBACnE,KAAI,CAAC,SAAS,EAAE,CAAC;gBACrB,CAAC,CAAC,CAAC;;;;KACN;IAED,iCAAiC;IAC3B,kCAAc,GAApB;;;gBACI,sBAAO,IAAI,OAAO,CAAO,UAAC,OAAO,EAAE,MAAM;wBACrC,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,KAAK,EAAE,UAAC,KAAY,EAAE,MAAkB;4BACvE,OAAO,EAAE,CAAC;wBACd,CAAC,CAAC,CAAC;oBACP,CAAC,CAAC,EAAC;;;KACN;IAED,OAAO;IACP,6BAAS,GAAT;QAAA,iBAyBC;QAxBG,IAAI,UAAU,GAAG,UAAC,cAAsB,EAAE,UAAkB,EAAE,IAAS;YACnE,IAAI,CAAC,KAAI,CAAC,WAAW,EAAE;gBACnB,KAAI,CAAC,WAAW,GAAG,IAAI,CAAC;gBAExB,OAAO;gBACP,iBAAO,CAAC,YAAY,EAAE,CAAC;aAC1B;YACD,IAAM,cAAc,GAAG,KAAI,CAAC,YAAY,GAAG,KAAI,CAAC,cAAc,CAAC;YAC/D,IAAI,KAAK,GAAG,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,cAAc,GAAG,UAAU,CAAC,GAAG,CAAC,GAAG,GAAG,cAAc,CAAC,CAAC,CAAC;YAChG,KAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC;QACrC,CAAC,CAAC;QAEF,IAAI,SAAS,GAAoB,uBAAU,CAAC,UAAU,CAAC,CAAC,CAAC,sBAAY,CAAC,CAAC,CAAC,mBAAS,CAAC;QAElF,qBAAS,CAAC,MAAM,CACZ,SAAS,EACT,IAAI,EACJ,CAAC,EACD;YACI,OAAO;YACP,iBAAO,CAAC,UAAU,EAAE,CAAC;QACzB,CAAC,EACD,UAAU,CACb,CAAC;IACN,CAAC;IAED,wCAAoB,GAApB,UAAqB,KAAa;QAC9B,OAAO;QACP,iBAAO,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;QAE1B,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,QAAQ,GAAG,KAAK,GAAG,GAAG,CAAC;QAC1E,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,QAAQ,GAAG,KAAK,GAAG,GAAG,CAAC;QAC3E,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,QAAQ,GAAG,KAAK,GAAG,GAAG,CAAC;QAC5E,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC,QAAQ,EAAE,GAAG,GAAG,CAAC;QAC7E,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC,QAAQ,EAAE,GAAG,GAAG,CAAC;QAC9E,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,MAAM,GAAG,KAAK,CAAC,QAAQ,EAAE,GAAG,GAAG,CAAC;QAE/E,aAAa;QACb,IAAI,CAAC,KAAK,uBAAU,CAAC,OAAO,IAAI,KAAK,IAAI,EAAE,EAAE;YACzC,IAAI,MAAM,GAAG,IAAI,CAAC,sBAAsB,CAAC,YAAY,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC;YACnE,IAAM,UAAU,GAAG,QAAQ,CAAC;YAC5B,IAAI,UAAU,KAAK,MAAM,CAAC,SAAS,EAAE;gBACjC,MAAM,CAAC,YAAY,CAAC,CAAC,EAAE,UAAU,EAAE,KAAK,CAAC,CAAC;aAC7C;SACJ;IACL,CAAC;IAzGa,mBAAS,GAAG,WAAW,CAAC;IAD7B,SAAS;QADrB,OAAO;OACK,SAAS,CA2GrB;IAAD,gBAAC;CA3GD,AA2GC,CA3G8B,qBAAW,GA2GzC;AA3GY,8BAAS","file":"","sourceRoot":"/","sourcesContent":["import { ConstValue } from '../../../../game/scripts/Data/ConstValue';\nimport GamePanel from '../../../../game/scripts/UI/panel/GamePanel';\nimport TeacherPanel from '../../../../game/scripts/UI/panel/TeacherPanel';\nimport { NetWork } from '../../Http/NetWork';\nimport { SoundManager } from '../../Manager/SoundManager';\nimport { UIManager } from '../../Manager/UIManager';\nimport GameMsg from '../../SDK/GameMsg';\nimport BaseFrameUI from '../BaseFrameUI';\nimport { BaseUI, UIClass } from '../BaseUI';\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport class LoadingUI extends BaseFrameUI {\n    public static className = 'LoadingUI';\n\n    private _nd_like: cc.Node = null;\n    private _pb_loading_like: cc.Node = null;\n    private _lb_percent_like: cc.Node = null;\n\n    private _nd_yuwen: cc.Node = null;\n    private _pb_loading_yuwen: cc.Node = null;\n    private _lb_percent_yuwen: cc.Node = null;\n\n    private _nd_yingyu: cc.Node = null;\n    private _pb_loading_yingyu: cc.Node = null;\n    private _lb_percent_yingyu: cc.Node = null;\n    private _sp_progressTag_yingyu: cc.Node = null;\n\n    private isLoadStart = false;\n    private readonly _resProgress: number = 20;\n    private readonly _audioProgress: number = 10;\n\n    onLoad() {\n        NetWork.GetRequest();\n\n        this.initPanelBySubject();\n        this.init();\n    }\n\n    async init() {\n        await this.loadPreloadDir();\n        this.setLoadingProgressUI(this._resProgress);\n        this.loadAudio();\n    }\n\n    // 根据学科设置界面\n    initPanelBySubject() {\n        const subject: number = ConstValue.Subject || 1;\n        this._nd_like.active = 1 === subject;\n        this._nd_yuwen.active = 2 === subject;\n        this._nd_yingyu.active = 3 === subject;\n        this._sp_progressTag_yingyu.getComponent(sp.Skeleton).setAnimation(0, 'loading', true);\n    }\n\n    // 预加载音频\n    async loadAudio() {\n        SoundManager.preLoadAllAudioClips(() => {\n            this.setLoadingProgressUI(this._resProgress + this._audioProgress);\n            this.openPanel();\n        });\n    }\n\n    // 预加载 'resources/preload' 目录下的资源\n    async loadPreloadDir() {\n        return new Promise<void>((resolve, reject) => {\n            cc.resources.loadDir('preload', cc.Asset, (error: Error, assets: cc.Asset[]) => {\n                resolve();\n            });\n        });\n    }\n\n    // 打开界面\n    openPanel() {\n        let onProgress = (completedCount: number, totalCount: number, item: any) => {\n            if (!this.isLoadStart) {\n                this.isLoadStart = true;\n\n                //新课堂上报\n                GameMsg.resLoadStart();\n            }\n            const finishProgress = this._resProgress + this._audioProgress;\n            let value = finishProgress + Math.round((completedCount / totalCount) * (100 - finishProgress));\n            this.setLoadingProgressUI(value);\n        };\n\n        let openPanel: UIClass<BaseUI> = ConstValue.IS_TEACHER ? TeacherPanel : GamePanel;\n\n        UIManager.openUI(\n            openPanel,\n            this,\n            0,\n            () => {\n                //新课堂上报\n                GameMsg.resLoadEnd();\n            },\n            onProgress,\n        );\n    }\n\n    setLoadingProgressUI(value: number) {\n        //新课堂上报\n        GameMsg.resLoading(value);\n\n        this._pb_loading_like.getComponent(cc.ProgressBar).progress = value / 100;\n        this._pb_loading_yuwen.getComponent(cc.ProgressBar).progress = value / 100;\n        this._pb_loading_yingyu.getComponent(cc.ProgressBar).progress = value / 100;\n        this._lb_percent_like.getComponent(cc.Label).string = value.toString() + '%';\n        this._lb_percent_yuwen.getComponent(cc.Label).string = value.toString() + '%';\n        this._lb_percent_yingyu.getComponent(cc.Label).string = value.toString() + '%';\n\n        // @ts-ignore\n        if (3 === ConstValue.Subject && value >= 80) {\n            let spComp = this._sp_progressTag_yingyu.getComponent(sp.Skeleton);\n            const finishAnim = 'finish';\n            if (finishAnim !== spComp.animation) {\n                spComp.setAnimation(0, finishAnim, false);\n            }\n        }\n    }\n}\n"]}