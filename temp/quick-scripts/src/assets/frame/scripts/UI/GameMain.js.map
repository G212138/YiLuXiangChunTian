{"version":3,"sources":["assets\\frame\\scripts\\UI\\GameMain.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { EditorManager } from '../../../game/scripts/Manager/EditorManager';\nimport { FrameMsgType } from '../Data/FrameMsgType';\nimport { NetWork } from '../Http/NetWork';\nimport { ListenerManager } from '../Manager/ListenerManager';\nimport { ReportManager } from '../Manager/ReportManager';\nimport { SoundManager } from '../Manager/SoundManager';\nimport { SyncData, SyncDataManager } from '../Manager/SyncDataManager';\nimport { UIManager } from '../Manager/UIManager';\nimport GameMsg from '../SDK/GameMsg';\nimport { Action, SendData, T2M } from '../SDK/T2M';\nimport { UIHelp } from '../Utils/UIHelp';\n\nconst { ccclass, property } = cc._decorator;\n\n// 开启抗锯齿\ncc.macro.ENABLE_WEBGL_ANTIALIAS = true;\n@ccclass\nexport class GameMain extends cc.Component {\n    onLoad() {\n        let loading = document.getElementById('loading-full');\n        if (loading) {\n            loading.style.display = 'none';\n        }\n        cc.macro.ENABLE_MULTI_TOUCH = false;\n\n        this.addSDKEventListener();\n        GameMsg.get_is_preload(NetWork.setIsPreload);\n        GameMsg.get_is_sync(NetWork.setIsSync);\n        GameMsg.get_role(NetWork.setIsTeacher);\n        GameMsg.get_is_supportKeepAndRestart(NetWork.setIsSupportKeepPlay);\n    }\n\n    addSDKEventListener() {\n        GameMsg.recv_show_gamePanel(this.onReceiveGameShow.bind(this));\n        GameMsg.recv_hide_gamePanel(this.onReceiveGameHide.bind(this));\n        GameMsg.recv_keep_playing(this.onReceiveKeepPlaying.bind(this));\n        GameMsg.recv_cancel_keep_playing(this.onReceiveCancellKeepPlaying.bind(this));\n        GameMsg.recv_restart(this.onReceiveRestart.bind(this));\n        GameMsg.recv_is_master(this.onReceiveIsMaster.bind(this));\n        //发送准备就绪，可以接收消息了\n        GameMsg.request_event_ready();\n    }\n\n    /**\n     * 监听接着玩\n     */\n    onReceiveKeepPlaying() {\n        console.log('onReceiveKeepPlaying');\n        if (!UIManager.isGameShowing) return;\n\n        //发送接着玩数据\n        let syncAction = new Action();\n        syncAction.type = FrameMsgType.ON_HEART_BREAK;\n        // syncAction.syncData.frameSyncData.actionId = -1;\n        let sendData = new SendData(true, [syncAction]);\n        GameMsg.request_keep_playing(sendData);\n        // UIHelp.showRecoverMask();\n    }\n\n    /**\n     * 监听取消接着玩\n     */\n    onReceiveCancellKeepPlaying() {\n        console.log('onReceiveCancellKeepPlaying');\n        if (!UIManager.isGameShowing) return;\n\n        T2M.setFastHeartBreakState();\n    }\n\n    /**\n     * 监听重新玩\n     */\n    onReceiveRestart() {\n        console.log('onReceiveRestart');\n        if (!UIManager.isGameShowing) return;\n\n        //发送重新玩成功回调\n        GameMsg.request_restart_over();\n        UIManager.closeAllUI();\n        SoundManager.stopAll();\n        SyncDataManager.initSyncData();\n        ReportManager.initReportData(EditorManager.getLevelCount());\n\n        this.scheduleOnce(() => {\n            UIHelp.showGamePanel();\n        });\n    }\n\n    /**\n     * 监听窗口打开\n     */\n    onReceiveGameShow() {\n        console.log('onReceiveGameShow');\n        if (UIManager.isGameShowing) return;\n\n        UIManager.isGameShowing = true;\n        ListenerManager.dispatch(FrameMsgType.PRELOAD_GAME_SHOW);\n    }\n\n    /**\n     * 监听窗口关闭\n     */\n    onReceiveGameHide() {\n        console.log('onReceiveGameHide');\n        if (!UIManager.isGameShowing) return;\n\n        UIManager.isGameShowing = false;\n        UIManager.closeAllUI();\n        SoundManager.stopAll();\n        SyncDataManager.initSyncData();\n        ReportManager.initReportData(EditorManager.getLevelCount());\n        T2M.isRecover = false;\n        this.scheduleOnce(() => {\n            UIHelp.showGamePanel();\n        });\n    }\n\n    /**\n     * 监听是否为主动发送心跳的一端\n     */\n    onReceiveIsMaster(data: any) {\n        NetWork.isMaster = data.data;\n        if (!NetWork.isMaster) {\n            T2M.isRecover = false;\n            UIHelp.showRecoverMask();\n            if (0 !== SyncDataManager.syncData.frameSyncData.actionId) {\n                SyncDataManager.syncData.frameSyncData.actionId = -999;\n            }\n        } else {\n            UIHelp.closeRecoverMask();\n        }\n\n        console.log(`onReceiveIsMaster isMaster: ${NetWork.isMaster}`);\n    }\n}\n"]}